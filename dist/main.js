(()=>{"use strict";const e={formSelector:".edit-box",fieldsetSelector:".edit-box__set",inputSelector:".edit-box__input",submitButtonSelector:".edit-box__button",inactiveButtonClass:"edit-box__button_inactive",inputErrorClass:"edit-box__input_type_error",errorClass:"edit-box__input-error_active"};class t{constructor(e,t){this._settings=e,this._formElement=t}_showInputError=(e,t,n)=>{const i=e.querySelector(`#${t.id}-error`);t.classList.add(this._settings.inputErrorClass),i.textContent=n,i.classList.add(this._settings.errorClass)};_hideInputError=(e,t)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(this._settings.inputErrorClass),n.classList.remove(this._settings.errorClass),n.textContent=""};_isValid=(e,t)=>{t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,t.validationMessage)};_hasInvalidInput=e=>e.some((e=>!e.validity.valid));_toggleButtonState=(e,t)=>{this._hasInvalidInput(e)?(t.classList.add(this._settings.inactiveButtonClass),t.disabled=!0):(t.classList.remove(this._settings.inactiveButtonClass),t.disabled=!1)};_setEventListeners=e=>{const t=Array.from(e.querySelectorAll(this._settings.inputSelector)),n=e.querySelector(this._settings.submitButtonSelector);this._toggleButtonState(t,n),t.forEach((i=>{i.addEventListener("input",(()=>{this._isValid(e,i),this._toggleButtonState(t,n)}))}))};enableValidation=()=>{Array.from(document.querySelectorAll(this._settings.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),Array.from(e.querySelectorAll(this._settings.fieldsetSelector)).forEach((e=>{this._setEventListeners(e)}))}))}}class n{constructor({items:e,renderer:t},n){this._renderedItems=e,this._renderer=t,this._container=document.querySelector(n)}renderer(){this._renderedItems.forEach((e=>this._renderer(e)))}addItem(e){this._container.append(e),"newCardElement"===e?this._container.prepend(e):this._container.append(e)}}class i extends q{constructor({popupSelector:e,handleFormSubmit:t}){super(e),this._handleFormSubmit=t}close(){super.close(),this._popupElement.querySelectorAll("edit-box__input").forEach((e=>e.reset()))}_getInputValues(){return this._inputList=this._popupElement.querySelectorAll(".edit-box__input"),this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._popupElement.querySelector(".edit-box__button").addEventListener("click",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()}))}}class o{constructor({userName:e,userDescription:t}){this._userNameElement=document.querySelector(e),this._userDescriptionElement=document.querySelector(t)}getUserInfo(){return{userName:this._userNameElement.textContent,userDescription:this._userDescriptionElement.textContent}}setUserInfo(e){const{username:t,userdescription:n}=e;this._userNameElement.textContent=t,this._userDescriptionElement.textContent=n}}const s=new t(e,".edit-box_type_profile"),r=new t(e,".edit-box_type_image");s.enableValidation(),r.enableValidation(),document.querySelector(".profile__title"),document.querySelector(".profile__subtitle"),document.querySelectorAll(".modal");const a=document.querySelector(".profile__button-edit"),l=(document.querySelector(".modal_type_edit"),document.querySelector(".image-grid")),d=document.querySelector(".edit-box_type_image"),c=(document.querySelector(".image-expand"),document.querySelector(".edit-box_type_profile"),document.querySelector(".modal_type_add")),u=document.querySelector(".edit-box__input_type_image-title"),_=document.querySelector(".edit-box__input_type_image-link"),m=document.querySelector(".profile__button-add"),p=document.querySelector(".edit-box__input_type_title"),h=document.querySelector(".edit-box__input_type_description"),y=(document.querySelector(".edit-box__button_edit"),document.querySelector(".edit-box__button_add"),new n({items:[{name:"Yosemite Valley",link:"https://code.s3.yandex.net/web-code/yosemite.jpg"},{name:"Lake Louise",link:"https://code.s3.yandex.net/web-code/lake-louise.jpg"},{name:"Bald Mountains",link:"https://code.s3.yandex.net/web-code/bald-mountains.jpg"},{name:"Latemar",link:"https://code.s3.yandex.net/web-code/latemar.jpg"},{name:"Vanoise National Park",link:"https://code.s3.yandex.net/web-code/vanoise.jpg"},{name:"Lago di Braies",link:"https://code.s3.yandex.net/web-code/lago.jpg"}],renderer:e=>{const t=new v({data:e,handleCardClick:({link:e,name:t})=>{g.open({link:e,name:t})}},"#image-card-template").generateCard();y.addItem(t)}},".image-grid"));y.renderer();const g=new x(".image-expand");g.setEventListeners();const S=new i({popupSelector:".modal_type_edit",handleFormSubmit:e=>{b.setUserInfo(e)}});S.setEventListeners();const b=new o({userName:".profile__title",userDescription:".profile__subtitle"});a.addEventListener("click",(()=>{const{userName:e,userDescription:t}=b.getUserInfo();p.value=e,h.value=t,S.open()}));const E=new i({popupSelector:".modal_type_add",handleFormSubmit:e=>{const t=new v({data:e,handleCardClick:({name:e,link:t})=>{g.open({name:e,link:t})}},"#image-card-template").generateCard();y.addItem(t),console.log(E._getInputValues())}});E.setEventListeners(),m.addEventListener("click",(()=>{E.open()})),d.addEventListener("submit",(function(e){e.preventDefault();const t=new v({name:u.value,link:_.value},"#image-card-template").generateCard();l.prepend(t),closePopUp(c)}));class q{constructor(e){this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("modal_open"),document.addEventListener("keyup",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_open"),document.removeEventListener("keyup",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.addEventListener("click",(e=>{(e.target.classList.contains("modal_open")||e.target.classList.contains("modal__close-icon"))&&this.close()}))}}class x extends q{constructor(e){super(e)}open({link:e,name:t}){this._popupElement.querySelector(".image-expand__image").src=e,this._popupElement.querySelector(".image-expand__title").textContent=t,this._popupElement.querySelector(".image-expand__image").setAttribute("alt",t),super.open()}}class v{constructor({data:e,handleCardClick:t},n){this._name=e.name,this._link=e.link,this._template=n,this._handleCardClick=t}_getTemplate(){return document.querySelector(this._template).content.querySelector(".image-card").cloneNode(!0)}_toggleHearts(){this._element.querySelector(".image-card__heart").classList.toggle("image-card__heart_liked")}_deleteImage(){this._element.querySelector(".image-card__trash").closest(".image-card").remove()}_setEventListeners(){this._element.querySelector(".image-card__heart").addEventListener("click",(()=>this._toggleHearts())),this._element.querySelector(".image-card__trash").addEventListener("click",(()=>this._deleteImage())),this._element.querySelector(".image-card__image").addEventListener("click",(()=>this._handleCardClick({name:this._name,link:this._link})))}generateCard(){this._element=this._getTemplate(),this._setEventListeners();const e=this._element.querySelector(".image-card__image");return this._element.querySelector(".image-card__title").textContent=this._name,e.src=this._link,e.setAttribute("alt",this._name),this._element}}const k=new t(e,".edit-box_type_profile"),L=new t(e,".edit-box_type_image");k.enableValidation(),L.enableValidation(),console.log("hi"),console.log("bye"),document.querySelector(".profile__title"),document.querySelector(".profile__subtitle"),document.querySelectorAll(".modal");const f=document.querySelector(".profile__button-edit"),C=(document.querySelector(".modal_type_edit"),document.querySelector(".image-grid"),document.querySelector(".edit-box_type_image"),document.querySelector(".image-expand"),document.querySelector(".edit-box_type_profile"),document.querySelector(".modal_type_add"),document.querySelector(".edit-box__input_type_image-title"),document.querySelector(".edit-box__input_type_image-link"),document.querySelector(".profile__button-add")),w=document.querySelector(".edit-box__input_type_title"),I=document.querySelector(".edit-box__input_type_description"),V=(document.querySelector(".edit-box__button_edit"),document.querySelector(".edit-box__button_add"),new n({items:[{name:"Yosemite Valley",link:"https://code.s3.yandex.net/web-code/yosemite.jpg"},{name:"Lake Louise",link:"https://code.s3.yandex.net/web-code/lake-louise.jpg"},{name:"Bald Mountains",link:"https://code.s3.yandex.net/web-code/bald-mountains.jpg"},{name:"Latemar",link:"https://code.s3.yandex.net/web-code/latemar.jpg"},{name:"Vanoise National Park",link:"https://code.s3.yandex.net/web-code/vanoise.jpg"},{name:"Lago di Braies",link:"https://code.s3.yandex.net/web-code/lago.jpg"}],renderer:e=>{const t=new v({data:e,handleCardClick:({link:e,name:t})=>{j.open({link:e,name:t})}},"#image-card-template").generateCard();V.addItem(t)}},".image-grid"));V.renderer();const j=new x(".image-expand");j.setEventListeners();const A=new i({popupSelector:".modal_type_edit",handleFormSubmit:e=>{B.setUserInfo(e)}});A.setEventListeners();const B=new o({userName:".profile__title",userDescription:".profile__subtitle"});f.addEventListener("click",(()=>{const{userName:e,userDescription:t}=B.getUserInfo();w.value=e,I.value=t,A.open()}));const D=new i({popupSelector:".modal_type_add",handleFormSubmit:e=>{const t=new v({data:e,handleCardClick:({name:e,link:t})=>{j.open({name:e,link:t})}},"#image-card-template").generateCard();V.addItem(t)}});D.setEventListeners(),C.addEventListener("click",(()=>{D.open()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zY3JpcHRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NjcmlwdHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc2NyaXB0cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc2NyaXB0cy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc2NyaXB0cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc2NyaXB0cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc2NyaXB0cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvaW5kZXguanMiXSwibmFtZXMiOlsic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJmaWVsZHNldFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJGb3JtVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnQiLCJ0aGlzIiwiX3NldHRpbmdzIiwiX2Zvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImlkIiwiY2xhc3NMaXN0IiwiYWRkIiwidGV4dENvbnRlbnQiLCJyZW1vdmUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJpbnB1dExpc3QiLCJzb21lIiwiYnV0dG9uRWxlbWVudCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlZCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9pc1ZhbGlkIiwiZG9jdW1lbnQiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsImZpZWxkc2V0IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiU2VjdGlvbiIsIml0ZW1zIiwicmVuZGVyZXIiLCJjb250YWluZXJTZWxlY3RvciIsIl9yZW5kZXJlZEl0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsIml0ZW0iLCJlbGVtZW50IiwiYXBwZW5kIiwicHJlcGVuZCIsIlBvcHVwV2l0aEZvcm0iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsImNsb3NlIiwiX3BvcHVwRWxlbWVudCIsImlucHV0IiwicmVzZXQiLCJfaW5wdXRMaXN0IiwiX2Zvcm1WYWx1ZXMiLCJuYW1lIiwidmFsdWUiLCJzZXRFdmVudExpc3RlbmVycyIsIl9nZXRJbnB1dFZhbHVlcyIsIlVzZXJJbmZvIiwidXNlck5hbWUiLCJ1c2VyRGVzY3JpcHRpb24iLCJfdXNlck5hbWVFbGVtZW50IiwiX3VzZXJEZXNjcmlwdGlvbkVsZW1lbnQiLCJkYXRhIiwidXNlcm5hbWUiLCJ1c2VyZGVzY3JpcHRpb24iLCJwcm9maWxlTW9kYWxWYWxpZGF0b3IiLCJpbWFnZU1vZGFsVmFsaWRhdG9yIiwiZW5hYmxlVmFsaWRhdGlvbiIsIm9wZW5FZGl0Rm9ybUJ1dHRvbiIsImltYWdlR3JpZCIsImFkZEZvcm0iLCJhZGRQb3BVcCIsImlucHV0SW1hZ2VUaXRsZSIsImlucHV0SW1hZ2VMaW5rIiwib3BlbkFkZEZvcm1CdXR0b24iLCJpbnB1dFRpdGxlIiwiaW5wdXREZXNjcmlwdGlvbiIsImNhcmRzTGlzdCIsImxpbmsiLCJjYXJkRWxlbWVudCIsIkNhcmQiLCJoYW5kbGVDYXJkQ2xpY2siLCJpbWFnZVBvcHVwIiwib3BlbiIsImdlbmVyYXRlQ2FyZCIsImFkZEl0ZW0iLCJQb3B1cFdpdGhJbWFnZSIsImVkaXRQb3B1cCIsIm5ld1VzZXIiLCJzZXRVc2VySW5mbyIsImdldFVzZXJJbmZvIiwiYWRkQ2FyZFBvcHVwIiwiY29uc29sZSIsImxvZyIsImNsb3NlUG9wVXAiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsInRhcmdldCIsImNvbnRhaW5zIiwic3JjIiwic2V0QXR0cmlidXRlIiwidGVtcGxhdGUiLCJfbmFtZSIsIl9saW5rIiwiX3RlbXBsYXRlIiwiX2hhbmRsZUNhcmRDbGljayIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfZWxlbWVudCIsInRvZ2dsZSIsImNsb3Nlc3QiLCJfdG9nZ2xlSGVhcnRzIiwiX2RlbGV0ZUltYWdlIiwiX2dldFRlbXBsYXRlIiwiaW1hZ2VDYXJkSW1hZ2UiLCJuZXdDYXJkRWxlbWVudCJdLCJtYXBwaW5ncyI6Im1CQUNBLE1BQU1BLEVBQVcsQ0FDYkMsYUFBYyxZQUNkQyxpQkFBa0IsaUJBQ2xCQyxjQUFlLG1CQUNmQyxxQkFBc0Isb0JBQ3RCQyxvQkFBcUIsNEJBQ3JCQyxnQkFBaUIsNkJBQ2pCQyxXQUFZLGdDQUdoQixNQUFNQyxFQUNGLFlBQVlSLEVBQVVTLEdBQ2xCQyxLQUFLQyxVQUFZWCxFQUNqQlUsS0FBS0UsYUFBZUgsRUFLeEIsZ0JBQWtCLENBQUNBLEVBQWFJLEVBQWNDLEtBQzFDLE1BQU1DLEVBQWVOLEVBQVlPLGNBQWMsSUFBSUgsRUFBYUksWUFDaEVKLEVBQWFLLFVBQVVDLElBQUlULEtBQUtDLFVBQVVMLGlCQUMxQ1MsRUFBYUssWUFBY04sRUFDM0JDLEVBQWFHLFVBQVVDLElBQUlULEtBQUtDLFVBQVVKLGFBRzlDLGdCQUFrQixDQUFDRSxFQUFhSSxLQUM1QixNQUFNRSxFQUFlTixFQUFZTyxjQUFjLElBQUlILEVBQWFJLFlBQ2hFSixFQUFhSyxVQUFVRyxPQUFPWCxLQUFLQyxVQUFVTCxpQkFDN0NT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QU15QixXQUU3Qix3QkFDNEJNLGVBQy9CLEVBQVVDLFFBQVFnQyxNQUcxQixFQUFhOUQsb0JBRWIsRUFBa0JoQyxpQkFBaUIsU0FBUyxLQUFRLEVBQWE0RCxXIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmNvbnN0IHNldHRpbmdzID0ge1xuICAgIGZvcm1TZWxlY3RvcjogXCIuZWRpdC1ib3hcIixcbiAgICBmaWVsZHNldFNlbGVjdG9yOiBcIi5lZGl0LWJveF9fc2V0XCIsXG4gICAgaW5wdXRTZWxlY3RvcjogXCIuZWRpdC1ib3hfX2lucHV0XCIsXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLmVkaXQtYm94X19idXR0b25cIixcbiAgICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcImVkaXQtYm94X19idXR0b25faW5hY3RpdmVcIixcbiAgICBpbnB1dEVycm9yQ2xhc3M6IFwiZWRpdC1ib3hfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgICBlcnJvckNsYXNzOiBcImVkaXQtYm94X19pbnB1dC1lcnJvcl9hY3RpdmVcIixcbn1cblxuY2xhc3MgRm9ybVZhbGlkYXRvciB7XG4gICAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX3NldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGlvbiBGdW5jdGlvbnMgLy9cblxuICAgIF9zaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpID0+IHtcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICAgIH07XG5cbiAgICBfaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gICAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIH07XG5cbiAgICBfaXNWYWxpZCA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgX2hhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgICAgICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgX3RvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIF9zZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCkgPT4ge1xuICAgICAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fc2V0dGluZ3MuaW5wdXRTZWxlY3RvcikpO1xuICAgICAgICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9zZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KTtcblxuICAgICAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICAgICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc1ZhbGlkKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGVuYWJsZVZhbGlkYXRpb24gPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmZvcm1TZWxlY3RvcikpO1xuICAgICAgICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgZmllbGRzZXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmZpZWxkc2V0U2VsZWN0b3IpKTtcblxuICAgICAgICAgICAgZmllbGRzZXRMaXN0LmZvckVhY2goKGZpZWxkc2V0KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoZmllbGRzZXQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbn1cblxuXG5cblxuXG5leHBvcnQge3NldHRpbmdzLCBGb3JtVmFsaWRhdG9yfTtcbiIsIlxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyZWRJdGVtcyA9IGl0ZW1zO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICByZW5kZXJlcigpIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyZWRJdGVtcy5mb3JFYWNoKGl0ZW0gPT4gdGhpcy5fcmVuZGVyZXIoaXRlbSkpO1xuICAgIH1cblxuICAgIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgICAgICB0aGlzLl9jb250YWluZXIuYXBwZW5kKGVsZW1lbnQpO1xuICAgICAgICBpZiAoZWxlbWVudCA9PT0gXCJuZXdDYXJkRWxlbWVudFwiKSB7XG4gICAgICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmQoZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuaW1wb3J0IENhcmQgZnJvbSBcIi4vQ2FyZC5qc1wiO1xuXG5pbXBvcnQgeyBpbWFnZVBvcHVwLCBjYXJkc0xpc3QgfSBmcm9tIFwiLi9pbmRleC5qc1wiO1xuXG5cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcblxuICAgIGNvbnN0cnVjdG9yKHsgcG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCB9KSB7XG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICB9XG5cbiAgICBcbiAgICBjbG9zZSgpIHtcbiAgICAgICAgc3VwZXIuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJlZGl0LWJveF9faW5wdXRcIikuZm9yRWFjaChpbnB1dCA9PiBpbnB1dC5yZXNldCgpKTtcbiAgICB9XG5cblxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZWRpdC1ib3hfX2lucHV0XCIpO1xuICAgICAgICB0aGlzLl9mb3JtVmFsdWVzID0ge307XG5cbiAgICAgICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgICAgICAgdGhpcy5fZm9ybVZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1WYWx1ZXM7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWRpdC1ib3hfX2J1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7ICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfSlcblxuICAgIH1cblxuXG59IC8qIFBvcHVwV2l0aGZvcm0gY2xhc3MgKi9cblxuXG5cblxuXG4iLCJpbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi9Qb3B1cFdpdGhGb3JtLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgICBjb25zdHJ1Y3Rvcih7IHVzZXJOYW1lLCB1c2VyRGVzY3JpcHRpb24gfSkge1xuICAgICAgICB0aGlzLl91c2VyTmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJOYW1lKTtcbiAgICAgICAgdGhpcy5fdXNlckRlc2NyaXB0aW9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlckRlc2NyaXB0aW9uKTtcbiAgICB9XG5cbiAgICBnZXRVc2VySW5mbygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVzZXJOYW1lOiB0aGlzLl91c2VyTmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgICAgICAgICB1c2VyRGVzY3JpcHRpb246IHRoaXMuX3VzZXJEZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRVc2VySW5mbyhkYXRhKSB7XG4gICAgICAgIGNvbnN0IHt1c2VybmFtZSwgdXNlcmRlc2NyaXB0aW9ufSA9IGRhdGE7XG4gICAgICAgIHRoaXMuX3VzZXJOYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IHVzZXJuYW1lO1xuICAgICAgICB0aGlzLl91c2VyRGVzY3JpcHRpb25FbGVtZW50LnRleHRDb250ZW50ID0gdXNlcmRlc2NyaXB0aW9uO1xuICAgIH1cblxufVxuXG4gIiwiaW1wb3J0IENhcmQgZnJvbSBcIi4vQ2FyZC5qc1wiO1xuXG5pbXBvcnQgeyBzZXR0aW5ncywgRm9ybVZhbGlkYXRvciB9IGZyb20gXCIuL0Zvcm1WYWxpZGF0b3IuanNcIjtcblxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4vU2VjdGlvbi5qc1wiO1xuXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4vUG9wdXBXaXRoSW1hZ2UuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi9Vc2VySW5mby5qc1wiO1xuXG5cbmNvbnN0IHByb2ZpbGVNb2RhbFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBcIi5lZGl0LWJveF90eXBlX3Byb2ZpbGVcIik7XG5cbmNvbnN0IGltYWdlTW9kYWxWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihzZXR0aW5ncywgXCIuZWRpdC1ib3hfdHlwZV9pbWFnZVwiKTtcblxuXG5wcm9maWxlTW9kYWxWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5pbWFnZU1vZGFsVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuXG5cblxuY29uc3QgcHJvZmlsZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX190aXRsZVwiKTtcblxuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19zdWJ0aXRsZVwiKTtcblxuZXhwb3J0IGNvbnN0IHBvcFVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcblxuY29uc3Qgb3BlbkVkaXRGb3JtQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19idXR0b24tZWRpdFwiKTtcblxuY29uc3QgZWRpdFBvcFVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF90eXBlX2VkaXRcIik7XG5cbmNvbnN0IGltYWdlR3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2UtZ3JpZFwiKTtcblxuY29uc3QgYWRkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWRpdC1ib3hfdHlwZV9pbWFnZVwiKTtcblxuY29uc3QgbW9kYWxJbWFnZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmltYWdlLWV4cGFuZFwiKTtcblxuY29uc3QgZWRpdEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtYm94X3R5cGVfcHJvZmlsZVwiKTtcblxuY29uc3QgYWRkUG9wVXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX3R5cGVfYWRkXCIpO1xuXG5jb25zdCBpbnB1dEltYWdlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtYm94X19pbnB1dF90eXBlX2ltYWdlLXRpdGxlXCIpO1xuXG5jb25zdCBpbnB1dEltYWdlTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWRpdC1ib3hfX2lucHV0X3R5cGVfaW1hZ2UtbGlua1wiKTtcblxuY29uc3Qgb3BlbkFkZEZvcm1CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvbi1hZGRcIik7XG5cbmNvbnN0IGlucHV0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtYm94X19pbnB1dF90eXBlX3RpdGxlXCIpO1xuXG5jb25zdCBpbnB1dERlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lZGl0LWJveF9faW5wdXRfdHlwZV9kZXNjcmlwdGlvblwiKTtcblxuY29uc3QgZWRpdEZvcm1TdWJtaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtYm94X19idXR0b25fZWRpdFwiKTtcblxuY29uc3QgYWRkRm9ybVN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWRpdC1ib3hfX2J1dHRvbl9hZGRcIik7XG5cblxuXG4vLyBJbml0aWFsIExvYWQgb2YgNiBJbWFnZSBDYXJkcyAvLyBcblxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICAgIHtcbiAgICAgICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS95b3NlbWl0ZS5qcGdcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFrZS1sb3Vpc2UuanBnXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2JhbGQtbW91bnRhaW5zLmpwZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhdGVtYXIuanBnXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS92YW5vaXNlLmpwZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWdvLmpwZ1wiXG4gICAgfVxuXTtcblxuXG5cbmV4cG9ydCBjb25zdCBjYXJkc0xpc3QgPSBuZXcgU2VjdGlvbih7XG4gICAgaXRlbXM6IGluaXRpYWxDYXJkcyxcbiAgICByZW5kZXJlcjogKGRhdGEpID0+IHtcbiAgICAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKHtcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBoYW5kbGVDYXJkQ2xpY2s6ICh7IGxpbmssIG5hbWUgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGltYWdlUG9wdXAub3Blbih7IGxpbmssIG5hbWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIFwiI2ltYWdlLWNhcmQtdGVtcGxhdGVcIik7XG5cbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xuICAgICAgICBjYXJkc0xpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XG4gICAgfSxcbn0sIFwiLmltYWdlLWdyaWRcIlxuKTtcbmNhcmRzTGlzdC5yZW5kZXJlcigpO1xuXG5cbmV4cG9ydCBjb25zdCBpbWFnZVBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiLmltYWdlLWV4cGFuZFwiKTtcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuXG5jb25zdCBlZGl0UG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gICAgcG9wdXBTZWxlY3RvcjogJy5tb2RhbF90eXBlX2VkaXQnLFxuICAgIGhhbmRsZUZvcm1TdWJtaXQ6IChkYXRhKSA9PiB7XG4gICAgICAgIG5ld1VzZXIuc2V0VXNlckluZm8oZGF0YSk7XG4gICAgfVxufSk7XG5lZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgbmV3VXNlciA9IG5ldyBVc2VySW5mbyh7XG4gICAgdXNlck5hbWU6IFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gICAgdXNlckRlc2NyaXB0aW9uOiBcIi5wcm9maWxlX19zdWJ0aXRsZVwiXG59KTtcblxub3BlbkVkaXRGb3JtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGNvbnN0IHt1c2VyTmFtZSwgdXNlckRlc2NyaXB0aW9ufSA9IG5ld1VzZXIuZ2V0VXNlckluZm8oKTtcbiAgICBpbnB1dFRpdGxlLnZhbHVlID0gdXNlck5hbWU7XG4gICAgaW5wdXREZXNjcmlwdGlvbi52YWx1ZSA9IHVzZXJEZXNjcmlwdGlvbjtcbiAgICBlZGl0UG9wdXAub3BlbigpO1xufSk7XG5cblxuXG5jb25zdCBhZGRDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gICAgcG9wdXBTZWxlY3RvcjogJy5tb2RhbF90eXBlX2FkZCcsXG4gICAgaGFuZGxlRm9ybVN1Ym1pdDogKGRhdGEpID0+IHtcbiAgICAgICAgY29uc3QgbmV3Q2FyZCA9IG5ldyBDYXJkKHtcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBoYW5kbGVDYXJkQ2xpY2s6ICh7IG5hbWUsIGxpbmsgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGltYWdlUG9wdXAub3Blbih7IG5hbWUsIGxpbmsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIFwiI2ltYWdlLWNhcmQtdGVtcGxhdGVcIik7XG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gbmV3Q2FyZC5nZW5lcmF0ZUNhcmQoKTtcbiAgICAgICAgY2FyZHNMaXN0LmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xuICAgICAgICBjb25zb2xlLmxvZyhhZGRDYXJkUG9wdXAuX2dldElucHV0VmFsdWVzKCkpO1xuICAgIH1cbn0pO1xuYWRkQ2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbm9wZW5BZGRGb3JtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBhZGRDYXJkUG9wdXAub3BlbigpIH0pO1xuXG5cblxuXG5cblxuXG5cbi8vIGluaXRpYWxDYXJkcy5mb3JFYWNoKGRhdGEgPT4ge1xuLy8gICAgIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChkYXRhLCBcIiNpbWFnZS1jYXJkLXRlbXBsYXRlXCIpO1xuXG4vLyAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xuXG4vLyAgICAgaW1hZ2VHcmlkLmFwcGVuZChjYXJkRWxlbWVudCk7XG4vLyB9KTtcblxuXG5cblxuLy8gZWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBhZGRQcm9maWxlSW5mbyk7XG5cblxuYWRkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBjYXJkID0gbmV3IENhcmQoeyBuYW1lOiBpbnB1dEltYWdlVGl0bGUudmFsdWUsIGxpbms6IGlucHV0SW1hZ2VMaW5rLnZhbHVlIH0sIFwiI2ltYWdlLWNhcmQtdGVtcGxhdGVcIik7XG5cbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmQuZ2VuZXJhdGVDYXJkKCk7XG5cbiAgICBpbWFnZUdyaWQucHJlcGVuZChjYXJkRWxlbWVudCk7XG4gICAgY2xvc2VQb3BVcChhZGRQb3BVcCk7XG59KTtcblxuXG5cbi8vIG9wZW5FZGl0Rm9ybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2dCkge1xuLy8gICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuLy8gICAgIGlucHV0VGl0bGUudmFsdWUgPSB0aXRsZS50ZXh0Q29udGVudDtcbi8vICAgICBpbnB1dERlc2NyaXB0aW9uLnZhbHVlID0gc3VidGl0bGUudGV4dENvbnRlbnQ7XG4vLyAgICAgZWRpdEZvcm1TdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbi8vICAgICBlZGl0Rm9ybVN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiZWRpdC1ib3hfX2J1dHRvbl9pbmFjdGl2ZVwiKTtcbi8vICAgICBvcGVuUG9wVXAoZWRpdFBvcFVwKTtcbi8vIH0pO1xuXG5cblxuLy8gb3BlbkFkZEZvcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldnQpIHtcbi8vICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbi8vICAgICBpbnB1dEltYWdlVGl0bGUudmFsdWUgPSBcIlwiO1xuLy8gICAgIGlucHV0SW1hZ2VMaW5rLnZhbHVlID0gXCJcIjtcbi8vICAgICBhZGRGb3JtU3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbi8vICAgICBhZGRGb3JtU3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJlZGl0LWJveF9fYnV0dG9uX2luYWN0aXZlXCIpO1xuLy8gICAgIG9wZW5Qb3BVcChhZGRQb3BVcCk7XG4vLyB9KTtcblxuLy8gcG9wVXAuZm9yRWFjaCgocG9wdXApID0+IHtcbi8vICAgICBwb3B1cC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcbi8vICAgICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9vcGVuJykpIHtcbi8vICAgICAgICAgICAgIGNsb3NlUG9wVXAocG9wdXApXG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fY2xvc2UtaWNvbicpKSB7XG4vLyAgICAgICAgICAgICBjbG9zZVBvcFVwKHBvcHVwKVxuLy8gICAgICAgICB9XG4vLyAgICAgfSlcbi8vIH0pO1xuXG5cblxuXG5cblxuXG5cblxuXG5cbiIsImltcG9ydCB7IHBvcFVwIH0gZnJvbSBcIi4vaW5kZXguanNcIjtcblxuaW1wb3J0IENhcmQgZnJvbSBcIi4vQ2FyZC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XG4gICAgfVxuXG4gICAgb3BlbigpIHtcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuXCIpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5cIik7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgfVxuXG4gICAgX2hhbmRsZUVzY0Nsb3NlKGV2dCkge1xuICAgICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuXG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfb3BlbicpIHx8IGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fY2xvc2UtaWNvbicpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgfVxuXG59XG5cblxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7IFxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIG9wZW4oe2xpbmssIG5hbWV9KSB7XG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmltYWdlLWV4cGFuZF9faW1hZ2VcIikuc3JjID0gbGluaztcbiAgICAgICAgdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2UtZXhwYW5kX190aXRsZVwiKS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmltYWdlLWV4cGFuZF9faW1hZ2VcIikuc2V0QXR0cmlidXRlKFwiYWx0XCIsIG5hbWUpO1xuICAgICAgICBzdXBlci5vcGVuKCk7XG4gICAgfVxufSIsIlxuXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4vUG9wdXBXaXRoSW1hZ2UuanNcIjtcblxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgICBjb25zdHJ1Y3Rvcih7ZGF0YSwgaGFuZGxlQ2FyZENsaWNrfSwgdGVtcGxhdGUpIHtcbiAgICAgICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICAgICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICAgICAgdGhpcy5fdGVtcGxhdGUgPSB0ZW1wbGF0ZTtcbiAgICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xuICAgIH1cblxuICAgIF9nZXRUZW1wbGF0ZSgpIHtcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudFxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fdGVtcGxhdGUpXG4gICAgICAgICAgICAuY29udGVudFxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2UtY2FyZFwiKVxuICAgICAgICAgICAgLmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XG4gICAgfVxuXG5cbiAgICAvLyBUb2dnbGUgSGVhcnRzIC8vXG5cbiAgICBfdG9nZ2xlSGVhcnRzKCkge1xuXG4gICAgICAgIGNvbnN0IGhlYXJ0QnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmltYWdlLWNhcmRfX2hlYXJ0XCIpO1xuXG4gICAgICAgIGhlYXJ0QnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJpbWFnZS1jYXJkX19oZWFydF9saWtlZFwiKTtcbiAgICB9O1xuXG4gICAgLy8gUmVtb3ZlIEltYWdlIENhcmQgLy8gXG5cbiAgICBfZGVsZXRlSW1hZ2UoKSB7XG5cbiAgICAgICAgY29uc3QgdHJhc2hCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2UtY2FyZF9fdHJhc2hcIik7XG5cbiAgICAgICAgdHJhc2hCdXR0b24uY2xvc2VzdChcIi5pbWFnZS1jYXJkXCIpLnJlbW92ZSgpO1xuICAgIH07XG5cblxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuaW1hZ2UtY2FyZF9faGVhcnQnKVxuICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5fdG9nZ2xlSGVhcnRzKCkpO1xuXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmltYWdlLWNhcmRfX3RyYXNoJylcbiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuX2RlbGV0ZUltYWdlKCkpO1xuXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmltYWdlLWNhcmRfX2ltYWdlJylcbiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuX2hhbmRsZUNhcmRDbGljayh7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5fbmFtZSxcbiAgICAgICAgICAgICAgICBsaW5rOiB0aGlzLl9saW5rLFxuICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xuICAgICAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuICAgICAgICBjb25zdCBpbWFnZUNhcmRJbWFnZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbWFnZS1jYXJkX19pbWFnZVwiKTtcblxuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2UtY2FyZF9fdGl0bGVcIikudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgICAgICBpbWFnZUNhcmRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xuICAgICAgICBpbWFnZUNhcmRJbWFnZS5zZXRBdHRyaWJ1dGUoXCJhbHRcIiwgdGhpcy5fbmFtZSk7XG5cblxuICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgICB9XG5cbn0iLCJpbXBvcnQgQ2FyZCBmcm9tIFwiLi4vc2NyaXB0cy9DYXJkLmpzXCI7XG5cbmltcG9ydCB7IHNldHRpbmdzLCBGb3JtVmFsaWRhdG9yIH0gZnJvbSBcIi4uL3NjcmlwdHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vc2NyaXB0cy9TZWN0aW9uLmpzXCI7XG5cbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vc2NyaXB0cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL3NjcmlwdHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9zY3JpcHRzL1VzZXJJbmZvLmpzXCI7XG5cblxuY29uc3QgcHJvZmlsZU1vZGFsVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIFwiLmVkaXQtYm94X3R5cGVfcHJvZmlsZVwiKTtcblxuY29uc3QgaW1hZ2VNb2RhbFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBcIi5lZGl0LWJveF90eXBlX2ltYWdlXCIpO1xuXG5cbnByb2ZpbGVNb2RhbFZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmltYWdlTW9kYWxWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zb2xlLmxvZyhcImhpXCIpO1xuY29uc29sZS5sb2coXCJieWVcIik7XG5cblxuY29uc3QgcHJvZmlsZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX190aXRsZVwiKTtcblxuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19zdWJ0aXRsZVwiKTtcblxuZXhwb3J0IGNvbnN0IHBvcFVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcblxuY29uc3Qgb3BlbkVkaXRGb3JtQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19idXR0b24tZWRpdFwiKTtcblxuY29uc3QgZWRpdFBvcFVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF90eXBlX2VkaXRcIik7XG5cbmNvbnN0IGltYWdlR3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2UtZ3JpZFwiKTtcblxuY29uc3QgYWRkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWRpdC1ib3hfdHlwZV9pbWFnZVwiKTtcblxuY29uc3QgbW9kYWxJbWFnZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmltYWdlLWV4cGFuZFwiKTtcblxuY29uc3QgZWRpdEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtYm94X3R5cGVfcHJvZmlsZVwiKTtcblxuY29uc3QgYWRkUG9wVXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX3R5cGVfYWRkXCIpO1xuXG5jb25zdCBpbnB1dEltYWdlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtYm94X19pbnB1dF90eXBlX2ltYWdlLXRpdGxlXCIpO1xuXG5jb25zdCBpbnB1dEltYWdlTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWRpdC1ib3hfX2lucHV0X3R5cGVfaW1hZ2UtbGlua1wiKTtcblxuY29uc3Qgb3BlbkFkZEZvcm1CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvbi1hZGRcIik7XG5cbmNvbnN0IGlucHV0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtYm94X19pbnB1dF90eXBlX3RpdGxlXCIpO1xuXG5jb25zdCBpbnB1dERlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lZGl0LWJveF9faW5wdXRfdHlwZV9kZXNjcmlwdGlvblwiKTtcblxuY29uc3QgZWRpdEZvcm1TdWJtaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVkaXQtYm94X19idXR0b25fZWRpdFwiKTtcblxuY29uc3QgYWRkRm9ybVN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWRpdC1ib3hfX2J1dHRvbl9hZGRcIik7XG5cblxuXG4vLyBJbml0aWFsIExvYWQgb2YgNiBJbWFnZSBDYXJkcyAvLyBcblxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICAgIHtcbiAgICAgICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS95b3NlbWl0ZS5qcGdcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFrZS1sb3Vpc2UuanBnXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2JhbGQtbW91bnRhaW5zLmpwZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhdGVtYXIuanBnXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS92YW5vaXNlLmpwZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWdvLmpwZ1wiXG4gICAgfVxuXTtcblxuXG5cbmV4cG9ydCBjb25zdCBjYXJkc0xpc3QgPSBuZXcgU2VjdGlvbih7XG4gICAgaXRlbXM6IGluaXRpYWxDYXJkcyxcbiAgICByZW5kZXJlcjogKGRhdGEpID0+IHtcbiAgICAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKHtcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBoYW5kbGVDYXJkQ2xpY2s6ICh7IGxpbmssIG5hbWUgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGltYWdlUG9wdXAub3Blbih7IGxpbmssIG5hbWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIFwiI2ltYWdlLWNhcmQtdGVtcGxhdGVcIik7XG5cbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xuICAgICAgICBjYXJkc0xpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XG4gICAgfSxcbn0sIFwiLmltYWdlLWdyaWRcIlxuKTtcbmNhcmRzTGlzdC5yZW5kZXJlcigpO1xuXG5cbmV4cG9ydCBjb25zdCBpbWFnZVBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiLmltYWdlLWV4cGFuZFwiKTtcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuXG5jb25zdCBlZGl0UG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gICAgcG9wdXBTZWxlY3RvcjogJy5tb2RhbF90eXBlX2VkaXQnLFxuICAgIGhhbmRsZUZvcm1TdWJtaXQ6IChkYXRhKSA9PiB7XG4gICAgICAgIG5ld1VzZXIuc2V0VXNlckluZm8oZGF0YSk7XG4gICAgfVxufSk7XG5lZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgbmV3VXNlciA9IG5ldyBVc2VySW5mbyh7XG4gICAgdXNlck5hbWU6IFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gICAgdXNlckRlc2NyaXB0aW9uOiBcIi5wcm9maWxlX19zdWJ0aXRsZVwiXG59KTtcblxub3BlbkVkaXRGb3JtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGNvbnN0IHt1c2VyTmFtZSwgdXNlckRlc2NyaXB0aW9ufSA9IG5ld1VzZXIuZ2V0VXNlckluZm8oKTtcbiAgICBpbnB1dFRpdGxlLnZhbHVlID0gdXNlck5hbWU7XG4gICAgaW5wdXREZXNjcmlwdGlvbi52YWx1ZSA9IHVzZXJEZXNjcmlwdGlvbjtcbiAgICBlZGl0UG9wdXAub3BlbigpO1xufSk7XG5cblxuY29uc3QgYWRkQ2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oe1xuICAgIHBvcHVwU2VsZWN0b3I6ICcubW9kYWxfdHlwZV9hZGQnLFxuICAgIGhhbmRsZUZvcm1TdWJtaXQ6IChkYXRhKSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld0NhcmQgPSBuZXcgQ2FyZCh7XG4gICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgaGFuZGxlQ2FyZENsaWNrOiAoeyBuYW1lLCBsaW5rIH0pID0+IHtcbiAgICAgICAgICAgICAgICBpbWFnZVBvcHVwLm9wZW4oeyBuYW1lLCBsaW5rIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBcIiNpbWFnZS1jYXJkLXRlbXBsYXRlXCIpO1xuICAgICAgICBjb25zdCBuZXdDYXJkRWxlbWVudCA9IG5ld0NhcmQuZ2VuZXJhdGVDYXJkKCk7XG4gICAgICAgIGNhcmRzTGlzdC5hZGRJdGVtKG5ld0NhcmRFbGVtZW50KTtcbiAgICB9XG59KTtcbmFkZENhcmRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5vcGVuQWRkRm9ybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgYWRkQ2FyZFBvcHVwLm9wZW4oKSB9KTtcblxuXG4vLyBpbml0aWFsQ2FyZHMuZm9yRWFjaChkYXRhID0+IHtcbi8vICAgICBjb25zdCBjYXJkID0gbmV3IENhcmQoZGF0YSwgXCIjaW1hZ2UtY2FyZC10ZW1wbGF0ZVwiKTtcblxuLy8gICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcblxuLy8gICAgIGltYWdlR3JpZC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xuLy8gfSk7XG5cblxuXG5cbi8vIGVkaXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgYWRkUHJvZmlsZUluZm8pO1xuXG5cbi8vIGFkZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XG4vLyAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4vLyAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKHsgbmFtZTogaW5wdXRJbWFnZVRpdGxlLnZhbHVlLCBsaW5rOiBpbnB1dEltYWdlTGluay52YWx1ZSB9LCBcIiNpbWFnZS1jYXJkLXRlbXBsYXRlXCIpO1xuXG4vLyAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xuXG4vLyAgICAgaW1hZ2VHcmlkLnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuLy8gICAgIGNsb3NlUG9wVXAoYWRkUG9wVXApO1xuLy8gfSk7XG5cblxuXG4vLyBvcGVuRWRpdEZvcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldnQpIHtcbi8vICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbi8vICAgICBpbnB1dFRpdGxlLnZhbHVlID0gdGl0bGUudGV4dENvbnRlbnQ7XG4vLyAgICAgaW5wdXREZXNjcmlwdGlvbi52YWx1ZSA9IHN1YnRpdGxlLnRleHRDb250ZW50O1xuLy8gICAgIGVkaXRGb3JtU3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4vLyAgICAgZWRpdEZvcm1TdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImVkaXQtYm94X19idXR0b25faW5hY3RpdmVcIik7XG4vLyAgICAgb3BlblBvcFVwKGVkaXRQb3BVcCk7XG4vLyB9KTtcblxuXG5cbi8vIG9wZW5BZGRGb3JtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZ0KSB7XG4vLyAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4vLyAgICAgaW5wdXRJbWFnZVRpdGxlLnZhbHVlID0gXCJcIjtcbi8vICAgICBpbnB1dEltYWdlTGluay52YWx1ZSA9IFwiXCI7XG4vLyAgICAgYWRkRm9ybVN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4vLyAgICAgYWRkRm9ybVN1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiZWRpdC1ib3hfX2J1dHRvbl9pbmFjdGl2ZVwiKTtcbi8vICAgICBvcGVuUG9wVXAoYWRkUG9wVXApO1xuLy8gfSk7XG5cbi8vIHBvcFVwLmZvckVhY2goKHBvcHVwKSA9PiB7XG4vLyAgICAgcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG4vLyAgICAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfb3BlbicpKSB7XG4vLyAgICAgICAgICAgICBjbG9zZVBvcFVwKHBvcHVwKVxuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX2Nsb3NlLWljb24nKSkge1xuLy8gICAgICAgICAgICAgY2xvc2VQb3BVcChwb3B1cClcbi8vICAgICAgICAgfVxuLy8gICAgIH0pXG4vLyB9KTtcblxuXG5cblxuXG5cblxuXG5cblxuXG4iXSwic291cmNlUm9vdCI6IiJ9